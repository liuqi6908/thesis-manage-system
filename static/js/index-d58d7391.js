import{h as ne,r as v,a as w,o as re,g as a,j as V,b as d,q as j,E as ie,D as N,d as X,c as se,w as E,e as C,f as Y,i as r,u as o,F as G,l as J,x as K,_ as ue}from"./index-6808ba74.js";import{m as b}from"./message-27522a78.js";import{t as de}from"./topic-d41e4ebe.js";import{P as Q}from"./index-eb0c4c8c.js";import{u as z}from"./hooks-62a2627c.js";import{D as ce}from"./delete-6d738bc7.js";import{R as pe}from"./refresh-74425c09.js";import{A as fe}from"./add-circle-line-438b436c.js";import"./epTheme-ce7d143e.js";const me=y=>ne.request("post","/studentModifyList",{data:y});function ge(){const y=v(),_=v(!0),c=[{type:"selection",width:50,align:"left",hide:({checkList:e})=>!e.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:e})=>!e.includes("序号列")},{label:"课题名称",prop:"title",minWidth:260},{label:"指导教师",prop:"teacher",minWidth:120},{label:"可接收总人数",prop:"total",minWidth:120},{label:"状态",minWidth:100,cellRenderer:e=>a(d("el-tag"),{key:e.row.id,type:"primary",class:"mx-1",effect:"light"},{default:()=>[V("接收")]})},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:e})=>j(e).format("YYYY-MM-DD HH:mm:ss")}],T=v(),k=w(["待审核","驳回","通过"]),i=v(!0),x=w({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `}),L=w({total:0,pageSize:10,currentPage:1,background:!0}),W=[{type:"selection",width:50,align:"left",hide:({checkList:e})=>!e.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:e})=>!e.includes("序号列")},{label:"原课题名称",prop:"oldTitle",minWidth:260},{label:"新课题名称",prop:"newTitle",minWidth:260},{label:"指导教师",prop:"teacher",minWidth:120},{label:"状态",minWidth:100,cellRenderer:e=>a(d("el-tag"),{key:e.row.id,type:["warning","danger","primary"][e.row.status],class:"mx-1",effect:"light"},{default:()=>[k[e.row.status]]})},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:e})=>j(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function P(e){ie.confirm(`确认要 <strong>删除</strong> <strong style='color:var(--el-color-primary)'>
      ${e.newTitle}</strong> 的课题修改申请吗?`,"删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value=!0,setTimeout(()=>{const R=T.value.map(s=>s.id).indexOf(e.id);R>-1&&T.value.splice(R,1),b("删除成功",{type:"success"}),i.value=!1},500)}).catch(()=>{})}function p(){x.text="正在加载...",i.value=!0,N(500).then(()=>{i.value=!1})}function U(e){x.text=`正在加载第${e}页...`,i.value=!0,N(500).then(()=>{i.value=!1})}function S(){i.value=!0,me().then(e=>{e.success?(T.value=e.data,L.total=e.data.length):b(e.message,{type:"error"})}).finally(()=>{setTimeout(()=>{i.value=!1},500)})}function M(){_.value=!0,de({status:4}).then(e=>{e.success?y.value=e.data:b(e.message,{type:"error"})}).finally(()=>{setTimeout(()=>{_.value=!1},500)})}return re(()=>{S(),M()}),{topicInfo:y,topicLoading:_,topicColumns:c,dataList:T,loading:i,loadingConfig:x,columns:W,statusList:k,pagination:L,onSearchDataList:S,onSearchTopicInfo:M,handleDelete:P,handleSizeChange:p,handleCurrentChange:U}}const he={class:"main"},ve=X({name:"ModifyTheTopic"}),be=X({...ve,setup(y){const _=v(),{topicInfo:c,topicLoading:T,topicColumns:k,dataList:i,loading:x,loadingConfig:L,columns:W,statusList:P,pagination:p,onSearchDataList:U,onSearchTopicInfo:S,handleDelete:M,handleSizeChange:e,handleCurrentChange:R}=ge(),s=w({oldTitle:"",newTitle:"",teacher:"",status:null}),Z=l=>{l&&l.resetFields()},D=v(!1),u=w({oldTitle:"",teacher:"",newTitle:""}),B=v(),ee=w({oldTitle:[{required:!0,message:"请选择原课题名称",trigger:"change"}],newTitle:[{required:!0,message:"请输入新课名称",trigger:"blur"}]}),A=se(()=>i.value?i.value.filter(l=>l.oldTitle?l.oldTitle.toString().toLowerCase().includes(s.oldTitle):!1).filter(l=>l.newTitle?l.newTitle.toString().toLowerCase().includes(s.newTitle):!1).filter(l=>l.teacher?l.teacher.toString().toLowerCase().includes(s.teacher):!1).filter(l=>[0,1,2].includes(s.status)?l.status===s.status:!0):[]);E(()=>{p.total=A.value.length}),E(()=>{if(u.oldTitle){for(let l=0;l<c.value.length;l)if(u.oldTitle===c.value[l].title){u.teacher=c.value[l].teacher;break}}});function le(){let l=0;for(let n=0;n<i.value.length;n++)i.value[n].status===0&&l++;if(l>=1)return b("新增失败，当前修改申请数量已达上限",{type:"error",grouping:!0});if(!c.value||c.value.length===0)return b("新增失败，当前暂无已选课题",{type:"error",grouping:!0});D.value=!0}function I(l){te(B.value),l?l():D.value=!1}const te=l=>{l&&l.resetFields()},ae=l=>{l&&l.validate(n=>{if(n){if(i.value.map(f=>f.oldTitle).includes(u.oldTitle))return b("新增失败，已存在该课题的修改申请",{type:"error",grouping:!0});{let f=Math.max(...i.value.map(h=>h.id));f>0||(f=0),i.value.push({id:f+1,oldTitle:u.oldTitle,newTitle:u.newTitle,teacher:u.teacher,status:0,createTime:new Date().getTime()}),I(),b("新增成功",{grouping:!0,type:"success"})}}})};return(l,n)=>{const f=d("pure-table"),h=d("el-input"),m=d("el-form-item"),H=d("el-option"),$=d("el-select"),F=d("el-button"),q=d("el-form"),oe=d("el-dialog");return C(),Y("div",he,[a(o(Q),{title:"已选课题",onRefresh:o(S),class:"overflow-hidden"},{default:r(({size:t,checkList:g})=>[a(f,{border:"","align-whole":"center",showOverflowTooltip:"",loading:o(T),size:t,data:o(c),columns:o(k),checkList:g,"header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"}},null,8,["loading","size","data","columns","checkList","header-cell-style"])]),_:1},8,["onRefresh"]),a(q,{ref_key:"formRef",ref:_,inline:!0,model:s,class:"bg-bg_color w-[99/100] pl-8 pt-4 mt-6"},{default:r(()=>[a(m,{label:"原课题名称：",prop:"oldTitle"},{default:r(()=>[a(h,{modelValue:s.oldTitle,"onUpdate:modelValue":n[0]||(n[0]=t=>s.oldTitle=t),placeholder:"请输入原课题名称",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),a(m,{label:"新课题名称：",prop:"newTitle"},{default:r(()=>[a(h,{modelValue:s.newTitle,"onUpdate:modelValue":n[1]||(n[1]=t=>s.newTitle=t),placeholder:"请输入新课题名称",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),a(m,{label:"指导教师：",prop:"teacher"},{default:r(()=>[a(h,{modelValue:s.teacher,"onUpdate:modelValue":n[2]||(n[2]=t=>s.teacher=t),placeholder:"请输入指导教师姓名",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),a(m,{label:"状态：",prop:"status"},{default:r(()=>[a($,{modelValue:s.status,"onUpdate:modelValue":n[3]||(n[3]=t=>s.status=t),placeholder:"请选择状态",clearable:"",class:"!w-[180px]"},{default:r(()=>[(C(!0),Y(G,null,J(o(P),(t,g)=>(C(),K(H,{key:g,label:t,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,null,{default:r(()=>[a(F,{icon:o(z)(o(pe)),onClick:n[4]||(n[4]=t=>Z(_.value))},{default:r(()=>[V(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),a(o(Q),{title:"题目修改申请",onRefresh:o(U),class:"overflow-hidden"},{buttons:r(()=>[a(F,{type:"primary",icon:o(z)(o(fe)),onClick:le},{default:r(()=>[V(" 新增申请 ")]),_:1},8,["icon"])]),default:r(({size:t,checkList:g})=>[a(f,{border:"","align-whole":"center",showOverflowTooltip:"",loading:o(x),"loading-config":o(L),size:t,height:t==="small"?130:160,data:o(A).slice((o(p).currentPage-1)*o(p).pageSize,o(p).currentPage*o(p).pageSize),columns:o(W),checkList:g,pagination:o(p),paginationSmall:t==="small","header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"},onPageSizeChange:o(e),onPageCurrentChange:o(R)},{operation:r(({row:O})=>[a(F,{class:"reset-margin",link:"",type:"danger",size:t,icon:o(z)(o(ce)),disabled:O.status===2,onClick:_e=>o(M)(O)},{default:r(()=>[V(" 删除 ")]),_:2},1032,["size","icon","disabled","onClick"])]),_:2},1032,["loading","loading-config","size","height","data","columns","checkList","pagination","paginationSmall","header-cell-style","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["onRefresh"]),a(oe,{modelValue:D.value,"onUpdate:modelValue":n[9]||(n[9]=t=>D.value=t),title:"新增申请",width:"500px","destroy-on-close":!0,"before-close":I},{footer:r(()=>[a(F,{type:"primary",onClick:n[8]||(n[8]=t=>ae(B.value))},{default:r(()=>[V(" 添加 ")]),_:1})]),default:r(()=>[a(q,{ref_key:"ruleFormRef",ref:B,model:u,rules:ee,"label-width":"100px","status-icon":""},{default:r(()=>[a(m,{label:"原课题名称",prop:"oldTitle"},{default:r(()=>[a($,{modelValue:u.oldTitle,"onUpdate:modelValue":n[5]||(n[5]=t=>u.oldTitle=t),placeholder:"请选择原课题名称",class:"w-full"},{default:r(()=>[(C(!0),Y(G,null,J(o(c).map(t=>t.title),(t,g)=>(C(),K(H,{key:g,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"指导教师",prop:"teacher"},{default:r(()=>[a(h,{modelValue:u.teacher,"onUpdate:modelValue":n[6]||(n[6]=t=>u.teacher=t),readonly:""},null,8,["modelValue"])]),_:1}),a(m,{label:"新课题名称",prop:"newTitle"},{default:r(()=>[a(h,{modelValue:u.newTitle,"onUpdate:modelValue":n[7]||(n[7]=t=>u.newTitle=t),placeholder:"请输入新课题名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const Me=ue(be,[["__scopeId","data-v-5beb756c"]]);export{Me as default};
