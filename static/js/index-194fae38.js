import{h as K,r as y,a as b,o as Q,g as o,b as d,q as se,E as ie,D as J,d as X,c as ue,w as de,e as h,f as D,i as n,u as a,x as V,F as $,l as z,ac as ce,ap as pe,j as R,p as fe,m as me,n as W,t as he,_ as ge}from"./index-6808ba74.js";import{m}from"./message-27522a78.js";import{P as _e}from"./index-eb0c4c8c.js";import{u as N}from"./hooks-62a2627c.js";import{t as Te}from"./topic-d41e4ebe.js";import{t as ve}from"./system-07b1b9f3.js";import{D as be}from"./delete-6d738bc7.js";import{R as ye}from"./refresh-74425c09.js";import{A as we}from"./add-circle-line-438b436c.js";import"./epTheme-ce7d143e.js";const xe=p=>K.request("post","/studentApplyList",{data:p}),Ve=p=>K.request("post","/studentTeacherInfo",{data:p});function Ce(){const p=y(),v=y(),f=b(["待审核","驳回","通过"]),s=y(!0),w=b({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `}),C=b({total:0,pageSize:10,currentPage:1,background:!0}),F=[{type:"selection",width:50,align:"left",hide:({checkList:r})=>!r.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:r})=>!r.includes("序号列")},{label:"原课题名称",prop:"oldTitle",minWidth:260},{label:"原指导教师",prop:"oldTeacher",minWidth:120},{label:"新指导教师",prop:"newTeacher",minWidth:120},{label:"状态",minWidth:100,cellRenderer:r=>o(d("el-tag"),{key:r.row.id,type:["warning","danger","primary"][r.row.status],class:"mx-1",effect:"light"},{default:()=>[f[r.row.status]]})},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:r})=>se(r).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function B(r){ie.confirm(`确认要 <strong>删除</strong> <strong style='color:var(--el-color-primary)'>
      ${r.newTeacher}</strong> 的指导教师更换申请吗?`,"删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{s.value=!0,setTimeout(()=>{const i=v.value.map(A=>A.id).indexOf(r.id);i>-1&&v.value.splice(i,1),m("删除成功",{type:"success"}),s.value=!1},500)}).catch(()=>{})}function g(){w.text="正在加载...",s.value=!0,J(500).then(()=>{s.value=!1})}function P(r){w.text=`正在加载第${r}页...`,s.value=!0,J(500).then(()=>{s.value=!1})}function k(){s.value=!0,xe().then(r=>{r.success?(v.value=r.data,C.total=r.data.length):m(r.message,{type:"error"})}).finally(()=>{setTimeout(()=>{s.value=!1},500)})}function U(){Ve().then(r=>{r.success?p.value=r.data:m(r.message,{type:"error"})})}return Q(()=>{k(),U()}),{teacher:p,dataList:v,loading:s,loadingConfig:w,columns:F,statusList:f,pagination:C,onSearch:k,handleDelete:B,handleSizeChange:g,handleCurrentChange:P}}const ke=p=>(fe("data-v-8d5de2b9"),p=p(),me(),p),Se={class:"main"},Le=ke(()=>W("div",{class:"card-header"},[W("span",{class:"font-bold"},"指导教师")],-1)),De={style:{color:"var(--el-color-primary)"}},Re=X({name:"SupervisedTeacher"}),Fe=X({...Re,setup(p){const v=y(),{teacher:f,dataList:s,loading:w,loadingConfig:C,columns:F,statusList:B,pagination:g,onSearch:P,handleDelete:k,handleSizeChange:U,handleCurrentChange:r}=Ce(),i=b({oldTitle:"",oldTeacher:"",newTeacher:"",status:null}),A=l=>{l&&l.resetFields()},S=y(!1),u=b({oldTitle:"",oldTeacher:"",newTeacher:""}),I=y(),Z=b({newTeacher:[{required:!0,message:"请选择新指导教师",trigger:"change"}]}),q=b([]),Y=ue(()=>s.value?s.value.filter(l=>l.oldTitle?l.oldTitle.toString().toLowerCase().includes(i.oldTitle):!1).filter(l=>l.oldTeacher?l.oldTeacher.toString().toLowerCase().includes(i.oldTeacher):!1).filter(l=>l.newTeacher?l.newTeacher.toString().toLowerCase().includes(i.newTeacher):!1).filter(l=>[0,1,2].includes(i.status)?l.status===i.status:!0):[]);de(()=>{g.total=Y.value.length});async function ee(){let l=0;for(let e=0;e<s.value.length;e++)s.value[e].status===0&&l++;if(l>=1)return m("新增失败，当前申请数量已达上限",{type:"error",grouping:!0});if(!f.value||f.value.length===0)return m("新增失败，当前暂无指导教师",{type:"error",grouping:!0});for(let e=0;e<f.value.length;e++)f.value[e].label==="姓名"&&(u.oldTeacher=f.value[e].field);if(!u.oldTeacher)return m("新增失败，未找到原指导教师",{type:"error",grouping:!0});if(await Te({status:4}).then(e=>{if(e.success){for(let c=0;c<e.data.length;c++)if(e.data[c].teacher===u.oldTeacher){u.oldTitle=e.data[c].title;break}}}),!u.oldTitle)return m("新增失败，未找到原课题名称",{type:"error",grouping:!0});S.value=!0}function H(l){le(I.value),l?l():S.value=!1}const le=l=>{l&&l.resetFields()},te=l=>{l&&l.validate(e=>{if(e){if(s.value.map(c=>c.oldTeacher).includes(u.oldTeacher))return m("新增失败，已存在该指导教师的更换申请",{type:"error",grouping:!0});{let c=Math.max(...s.value.map(M=>M.id));c>0||(c=0),s.value.push({id:c+1,oldTitle:u.oldTitle,oldTeacher:u.oldTeacher,newTeacher:u.newTeacher,status:0,createTime:new Date().getTime()}),H(),m("新增成功",{grouping:!0,type:"success"})}}})};return Q(()=>{ve().then(l=>{l.success?l.data&&l.data.length>0&&l.data.forEach(e=>{q.push({username:e.username,userNo:e.userNo})}):m(l.message,{type:"error"})})}),(l,e)=>{const c=d("el-descriptions-item"),M=d("el-descriptions"),ae=d("el-empty"),oe=d("el-card"),x=d("el-input"),_=d("el-form-item"),j=d("el-option"),E=d("el-select"),L=d("el-button"),O=d("el-form"),re=d("pure-table"),ne=d("el-dialog");return h(),D("div",Se,[o(oe,{class:"box-card",shadow:"never"},{header:n(()=>[Le]),default:n(()=>[a(f)&&a(f).length>0?(h(),V(M,{key:0,border:""},{default:n(()=>[(h(!0),D($,null,z(a(f),(t,T)=>(h(),V(c,{label:t.label,"label-align":"left",align:"left",key:T},{default:n(()=>[W("span",De,he(t.field),1)]),_:2},1032,["label"]))),128))]),_:1})):(h(),V(ae,{key:1,description:a(ce)(a(pe)("status.noData"))},null,8,["description"]))]),_:1}),o(O,{ref_key:"formRef",ref:v,inline:!0,model:i,class:"bg-bg_color w-[99/100] pl-8 pt-4 mt-6"},{default:n(()=>[o(_,{label:"原课题名称：",prop:"oldTitle"},{default:n(()=>[o(x,{modelValue:i.oldTitle,"onUpdate:modelValue":e[0]||(e[0]=t=>i.oldTitle=t),placeholder:"请输入原课题名称",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),o(_,{label:"原指导教师：",prop:"oldTeacher"},{default:n(()=>[o(x,{modelValue:i.oldTeacher,"onUpdate:modelValue":e[1]||(e[1]=t=>i.oldTeacher=t),placeholder:"请输入原指导教师姓名",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),o(_,{label:"新指导教师：",prop:"newTeacher"},{default:n(()=>[o(x,{modelValue:i.newTeacher,"onUpdate:modelValue":e[2]||(e[2]=t=>i.newTeacher=t),placeholder:"请输入新指导教师姓名",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),o(_,{label:"状态：",prop:"status"},{default:n(()=>[o(E,{modelValue:i.status,"onUpdate:modelValue":e[3]||(e[3]=t=>i.status=t),placeholder:"请选择状态",clearable:"",class:"!w-[180px]"},{default:n(()=>[(h(!0),D($,null,z(a(B),(t,T)=>(h(),V(j,{key:T,label:t,value:T},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(_,null,{default:n(()=>[o(L,{icon:a(N)(a(ye)),onClick:e[4]||(e[4]=t=>A(v.value))},{default:n(()=>[R(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),o(a(_e),{title:"更换指导教师申请",onRefresh:a(P),class:"overflow-hidden"},{buttons:n(()=>[o(L,{type:"primary",icon:a(N)(a(we)),onClick:ee},{default:n(()=>[R(" 新增申请 ")]),_:1},8,["icon"])]),default:n(({size:t,checkList:T})=>[o(re,{border:"","align-whole":"center",showOverflowTooltip:"",loading:a(w),"loading-config":a(C),size:t,height:t==="small"?130:160,data:a(Y).slice((a(g).currentPage-1)*a(g).pageSize,a(g).currentPage*a(g).pageSize),columns:a(F),checkList:T,pagination:a(g),paginationSmall:t==="small","header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"},onPageSizeChange:a(U),onPageCurrentChange:a(r)},{operation:n(({row:G})=>[o(L,{class:"reset-margin",link:"",type:"danger",size:t,icon:a(N)(a(be)),disabled:G.status===2,onClick:Be=>a(k)(G)},{default:n(()=>[R(" 删除 ")]),_:2},1032,["size","icon","disabled","onClick"])]),_:2},1032,["loading","loading-config","size","height","data","columns","checkList","pagination","paginationSmall","header-cell-style","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["onRefresh"]),o(ne,{modelValue:S.value,"onUpdate:modelValue":e[9]||(e[9]=t=>S.value=t),title:"新增申请",width:"500px","destroy-on-close":!0,"before-close":H},{footer:n(()=>[o(L,{type:"primary",onClick:e[8]||(e[8]=t=>te(I.value))},{default:n(()=>[R(" 添加 ")]),_:1})]),default:n(()=>[o(O,{ref_key:"ruleFormRef",ref:I,model:u,rules:Z,"label-width":"100px","status-icon":""},{default:n(()=>[o(_,{label:"原课题名称",prop:"oldTitle"},{default:n(()=>[o(x,{modelValue:u.oldTitle,"onUpdate:modelValue":e[5]||(e[5]=t=>u.oldTitle=t),readonly:""},null,8,["modelValue"])]),_:1}),o(_,{label:"原指导教师",prop:"oldTeacher"},{default:n(()=>[o(x,{modelValue:u.oldTeacher,"onUpdate:modelValue":e[6]||(e[6]=t=>u.oldTeacher=t),readonly:""},null,8,["modelValue"])]),_:1}),o(_,{label:"新指导教师",prop:"newTeacher"},{default:n(()=>[o(E,{modelValue:u.newTeacher,"onUpdate:modelValue":e[7]||(e[7]=t=>u.newTeacher=t),placeholder:"请选择新指导教师",class:"w-full",filterable:""},{default:n(()=>[(h(!0),D($,null,z(q,(t,T)=>(h(),V(j,{key:T,label:`${t.username} ${t.userNo}`,value:t.username},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const Ye=ge(Fe,[["__scopeId","data-v-8d5de2b9"]]);export{Ye as default};
