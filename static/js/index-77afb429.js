import{r as _,a as y,o as A,g as l,b as d,q as Z,E as ee,D as le,d as O,c as te,w as ae,e as M,f as $,i as o,u as s,j as V,F as oe,l as ne,x as re,_ as se}from"./index-6808ba74.js";import{m as C}from"./message-27522a78.js";import{t as ue,c as ie}from"./system-07b1b9f3.js";import{P as de}from"./index-eb0c4c8c.js";import{u as k}from"./hooks-62a2627c.js";import{D as me}from"./delete-6d738bc7.js";import{E as pe}from"./edit-pen-af58ba35.js";import{R as ce}from"./refresh-74425c09.js";import{A as ge}from"./add-circle-line-438b436c.js";import"./epTheme-ce7d143e.js";function fe(){const h=_(),p=_(!0),x=y({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `}),f=_({}),w=y({total:0,pageSize:10,currentPage:1,background:!0}),b=[{type:"selection",width:50,align:"left",hide:({checkList:e})=>!e.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:e})=>!e.includes("序号列")},{label:"姓名",prop:"username",minWidth:100},{label:"职工号",prop:"userNo",minWidth:100},{label:"性别",prop:"gender",minWidth:70},{label:"学院",prop:"college",minWidth:150},{label:"职称",prop:"jobTitle",minWidth:100},{label:"手机号",prop:"phone",minWidth:120},{label:"电子邮箱",prop:"email",minWidth:120},{label:"状态",minWidth:75,cellRenderer:e=>{var i;return l(d("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(i=f.value[e.index])==null?void 0:i.loading,modelValue:e.row.status,"onUpdate:modelValue":g=>e.row.status=g,"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","inline-prompt":!0,onChange:()=>c(e)},null)}},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:e})=>Z(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:150,slot:"operation"}];function c({row:e,index:i}){ee.confirm(`确认要 <strong>${e.status===0?"禁用":"启用"}</strong> <strong style='color:var(--el-color-primary)'>${e.username}</strong> 教师账号吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{f.value[i]=Object.assign({},f.value[i],{loading:!0}),setTimeout(()=>{f.value[i]=Object.assign({},f.value[i],{loading:!1}),C("已成功修改账号状态",{type:"success"})},300)}).catch(()=>{e.status===0?e.status=1:e.status=0})}function U(e){}function L(e){const i=h.value.map(g=>g.id).indexOf(e.id);i>=0&&h.value.splice(i,1),C("删除成功",{type:"success"})}function S(e){}function j(e){x.text=`正在加载第${e}页...`,p.value=!0,le(500).then(()=>{p.value=!1})}async function T(){p.value=!0,await ue().then(e=>{e.success?(h.value=e.data,w.total=e.data.length):C(e.message,{type:"error"})}).finally(()=>{setTimeout(()=>{p.value=!1},500)})}return A(()=>{T()}),{loading:p,loadingConfig:x,columns:b,dataList:h,pagination:w,onSearch:T,handleUpdate:U,handleDelete:L,handleSizeChange:S,handleCurrentChange:j}}const be={class:"main"},_e=O({name:"TeacherManagement"}),he=O({..._e,setup(h){const p=_(),{loading:x,loadingConfig:f,columns:w,dataList:b,pagination:c,onSearch:U,handleUpdate:L,handleDelete:S,handleSizeChange:j,handleCurrentChange:T}=fe(),e=y({username:"",userNo:"",status:null}),i=r=>{r&&r.resetFields()},g=_(!1),n=y({college:null,username:"",userNo:"",gender:"",jobTitle:"",phone:"",email:""}),R=_(),Y=y({college:[{required:!0,message:"请选择学院",trigger:"change"}],username:[{required:!0,message:"请输入姓名",trigger:"blur"}],userNo:[{required:!0,message:"请输入工号",trigger:"blur"}],gender:[{required:!0,message:"请选择性别",trigger:"change"}],jobTitle:[{required:!0,message:"请输入职称",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"}],email:[{required:!0,message:"请输入电子邮箱",trigger:"blur"}]}),N=_([]);A(()=>{ie({type:1}).then(r=>{r.success&&(N.value=r.data)})});const P=te(()=>b.value?b.value.filter(r=>r.username?r.username.toString().toLowerCase().includes(e.username):!1).filter(r=>r.userNo?r.userNo.toString().toLowerCase().includes(e.userNo):!1).filter(r=>e.status===0||e.status===1?r.status===e.status:!0):[]);ae(()=>{c.total=P.value.length});function W(r){E(R.value),r?r():g.value=!1}const E=r=>{r&&r.resetFields()},H=r=>{r&&r.validate(a=>{if(a){if(b.value.map(m=>m.userNo).includes(n.userNo))return C("新增失败，该教师已存在",{grouping:!0,type:"error"});{const m=N.value.map(u=>u.id).indexOf(n.college);b.value.push({id:Math.max(...b.value.map(u=>u.id))+1,username:n.username,userNo:n.userNo,gender:n.gender,college:N.value[m].name,jobTitle:n.jobTitle,phone:n.phone,email:n.email,status:1,createTime:new Date().getTime()}),W(),C("新增成功",{grouping:!0,type:"success"})}}})};return(r,a)=>{const m=d("el-input"),u=d("el-form-item"),F=d("el-option"),q=d("el-select"),v=d("el-button"),z=d("el-form"),I=d("el-popconfirm"),G=d("pure-table"),B=d("el-radio"),J=d("el-radio-group"),K=d("el-dialog");return M(),$("div",be,[l(z,{ref_key:"formRef",ref:p,inline:!0,model:e,class:"bg-bg_color w-[99/100] pl-8 pt-4"},{default:o(()=>[l(u,{label:"姓名：",prop:"username"},{default:o(()=>[l(m,{modelValue:e.username,"onUpdate:modelValue":a[0]||(a[0]=t=>e.username=t),placeholder:"请输入姓名",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),l(u,{label:"职工号：",prop:"userNo"},{default:o(()=>[l(m,{modelValue:e.userNo,"onUpdate:modelValue":a[1]||(a[1]=t=>e.userNo=t),placeholder:"请输入职工号",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),l(u,{label:"状态：",prop:"status"},{default:o(()=>[l(q,{modelValue:e.status,"onUpdate:modelValue":a[2]||(a[2]=t=>e.status=t),placeholder:"请选择状态",clearable:"",class:"!w-[180px]"},{default:o(()=>[l(F,{label:"启用",value:1}),l(F,{label:"禁用",value:0})]),_:1},8,["modelValue"])]),_:1}),l(u,null,{default:o(()=>[l(v,{icon:s(k)(s(ce)),onClick:a[3]||(a[3]=t=>i(p.value))},{default:o(()=>[V(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),l(s(de),{title:"教师列表",onRefresh:s(U),class:"overflow-hidden"},{buttons:o(()=>[l(v,{type:"primary",icon:s(k)(s(ge)),onClick:a[4]||(a[4]=t=>g.value=!0)},{default:o(()=>[V(" 新增教师 ")]),_:1},8,["icon"])]),default:o(({size:t,checkList:Q})=>[l(G,{border:"","align-whole":"center",showOverflowTooltip:"",loading:s(x),"loading-config":s(f),size:t,height:t==="small"?360:500,data:s(P).slice((s(c).currentPage-1)*s(c).pageSize,s(c).currentPage*s(c).pageSize),columns:s(w),checkList:Q,pagination:s(c),paginationSmall:t==="small","header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"},onPageSizeChange:s(j),onPageCurrentChange:s(T)},{operation:o(({row:D})=>[l(v,{class:"reset-margin",link:"",type:"primary",size:t,icon:s(k)(s(pe)),onClick:X=>s(L)(D)},{default:o(()=>[V(" 修改 ")]),_:2},1032,["size","icon","onClick"]),l(I,{title:"是否确认删除?",onConfirm:X=>s(S)(D)},{reference:o(()=>[l(v,{class:"reset-margin",link:"",type:"danger",size:t,icon:s(k)(s(me))},{default:o(()=>[V(" 删除 ")]),_:2},1032,["size","icon"])]),_:2},1032,["onConfirm"])]),_:2},1032,["loading","loading-config","size","height","data","columns","checkList","pagination","paginationSmall","header-cell-style","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["onRefresh"]),l(K,{modelValue:g.value,"onUpdate:modelValue":a[13]||(a[13]=t=>g.value=t),title:"新增教师",width:"500px","destroy-on-close":!0,"before-close":W},{footer:o(()=>[l(v,{type:"primary",onClick:a[12]||(a[12]=t=>H(R.value))},{default:o(()=>[V(" 添加 ")]),_:1})]),default:o(()=>[l(z,{ref_key:"ruleFormRef",ref:R,model:n,rules:Y,"label-width":"100px","status-icon":""},{default:o(()=>[l(u,{label:"学院",prop:"college"},{default:o(()=>[l(q,{modelValue:n.college,"onUpdate:modelValue":a[5]||(a[5]=t=>n.college=t),placeholder:"请选择学院",class:"w-full"},{default:o(()=>[(M(!0),$(oe,null,ne(N.value,t=>(M(),re(F,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"姓名",prop:"username"},{default:o(()=>[l(m,{modelValue:n.username,"onUpdate:modelValue":a[6]||(a[6]=t=>n.username=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"工号",prop:"userNo"},{default:o(()=>[l(m,{modelValue:n.userNo,"onUpdate:modelValue":a[7]||(a[7]=t=>n.userNo=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"性别",prop:"gender"},{default:o(()=>[l(J,{modelValue:n.gender,"onUpdate:modelValue":a[8]||(a[8]=t=>n.gender=t)},{default:o(()=>[l(B,{label:"男"}),l(B,{label:"女"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"职称",prop:"jobTitle"},{default:o(()=>[l(m,{modelValue:n.jobTitle,"onUpdate:modelValue":a[9]||(a[9]=t=>n.jobTitle=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"手机号",prop:"phone"},{default:o(()=>[l(m,{modelValue:n.phone,"onUpdate:modelValue":a[10]||(a[10]=t=>n.phone=t)},null,8,["modelValue"])]),_:1}),l(u,{label:"电子邮箱",prop:"email"},{default:o(()=>[l(m,{modelValue:n.email,"onUpdate:modelValue":a[11]||(a[11]=t=>n.email=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const Le=se(he,[["__scopeId","data-v-9fe87f7d"]]);export{Le as default};
