import{h as X,r as x,a as b,o as Z,g as l,b as p,q as ee,E as te,D as j,d as N,c as le,w as ae,e as h,f as S,i as n,F as W,l as z,u as a,j as R,x as $,_ as oe}from"./index-6808ba74.js";import{m as F}from"./message-27522a78.js";import{P as ne}from"./index-eb0c4c8c.js";import{u as q}from"./hooks-62a2627c.js";import{D as re}from"./delete-6d738bc7.js";import{R as se}from"./refresh-74425c09.js";import{A as ie}from"./add-circle-line-438b436c.js";import"./epTheme-ce7d143e.js";const ue=f=>X.request("post","/teacherGetTopicList",{data:f});function de(){const f=x(),y=b(["结合生产实际或经济建设","结合科研","结合实验室建设","教师自拟"]),w=b(["待审核","通过","驳回"]),i=x(!0),v=b({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `}),c=b({total:0,pageSize:10,currentPage:1,background:!0}),C=[{type:"selection",width:50,align:"left",hide:({checkList:t})=>!t.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:t})=>!t.includes("序号列")},{label:"课题名称",prop:"title",minWidth:300},{label:"课题类型",minWidth:150,cellRenderer:t=>l(p("el-text"),null,{default:()=>[y[t.row.type]]})},{label:"课题简介",prop:"introduce",minWidth:400},{label:"可接收总人数",prop:"total",minWidth:120},{label:"课题状态",minWidth:100,cellRenderer:t=>l(p("el-tag"),{key:t.row.id,type:["warning","primary","danger"][t.row.status],class:"mx-1",effect:"light"},{default:()=>[w[t.row.status]]})},{label:"选题学生",prop:"student",minWidth:90},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:t})=>ee(t).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function B(t){t.student||te.confirm(`确认要 <strong>删除</strong> <strong style='color:var(--el-color-primary)'>
      ${t.title}</strong> 课题吗?`,"删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value=!0,setTimeout(()=>{const k=f.value.findIndex(s=>s.id===t.id);k>-1&&f.value.splice(k,1),F("删除成功",{type:"success"}),i.value=!1},500)}).catch(()=>{})}function m(){v.text="正在加载...",i.value=!0,j(500).then(()=>{i.value=!1})}function M(t){v.text=`正在加载第${t}页...`,i.value=!0,j(500).then(()=>{i.value=!1})}function V(){i.value=!0,ue().then(t=>{t.success?(f.value=t.data,c.total=t.data.length):F(t.message,{type:"error"})}).finally(()=>{setTimeout(()=>{i.value=!1},500)})}return Z(()=>{V()}),{loading:i,loadingConfig:v,columns:C,dataList:f,typeList:y,statusList:w,pagination:c,onSearch:V,handleDelete:B,handleSizeChange:m,handleCurrentChange:M}}const pe={class:"main"},ce=N({name:"TopicManagement"}),me=N({...ce,setup(f){const y=x(),{loading:w,loadingConfig:i,columns:v,dataList:c,typeList:C,statusList:B,pagination:m,onSearch:M,handleDelete:V,handleSizeChange:t,handleCurrentChange:k}=de(),s=b({title:"",type:null,status:null}),E=r=>{r&&r.resetFields()},T=x(!1),u=b({title:"",type:null,introduce:""}),P=x(),G=b({title:[{required:!0,message:"请输入课题名称",trigger:"blur"}],type:[{required:!0,message:"请选择课题类型",trigger:"change"}],introduce:[{required:!0,message:"请输入课题简介",trigger:"blur"}]}),A=le(()=>c.value?c.value.filter(r=>r.title?r.title.toString().toLowerCase().includes(s.title):!1).filter(r=>[0,1,2,3].includes(s.type)?r.type===s.type:!0).filter(r=>[0,1,2].includes(s.status)?r.status===s.status:!0):[]);ae(()=>{m.total=A.value.length});function Y(r){O(P.value),r?r():T.value=!1}const O=r=>{r&&r.resetFields()},J=r=>{r&&r.validate(o=>{if(o){if(c.value.map(g=>g.title).includes(u.title))return F("新增失败，该课题已存在",{grouping:!0,type:"error"});setTimeout(()=>{c.value.push({id:Math.max(...c.value.map(g=>g.id))+1,title:u.title,type:u.type,introduce:u.introduce,total:1,status:0,student:"",createTime:new Date().getTime()}),Y(),F("新增成功",{grouping:!0,type:"success"})},600)}})};return(r,o)=>{const g=p("el-input"),_=p("el-form-item"),D=p("el-option"),U=p("el-select"),L=p("el-button"),H=p("el-form"),K=p("pure-table"),Q=p("el-dialog");return h(),S("div",pe,[l(H,{ref_key:"formRef",ref:y,inline:!0,model:s,class:"bg-bg_color w-[99/100] pl-8 pt-4"},{default:n(()=>[l(_,{label:"课题名称：",prop:"title"},{default:n(()=>[l(g,{modelValue:s.title,"onUpdate:modelValue":o[0]||(o[0]=e=>s.title=e),placeholder:"请输入课题名称",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),l(_,{label:"课题类型：",prop:"type"},{default:n(()=>[l(U,{modelValue:s.type,"onUpdate:modelValue":o[1]||(o[1]=e=>s.type=e),placeholder:"请选择课题类型",clearable:"",class:"!w-[180px]"},{default:n(()=>[(h(!0),S(W,null,z(a(C),(e,d)=>(h(),$(D,{key:d,label:e,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"课题状态：",prop:"status"},{default:n(()=>[l(U,{modelValue:s.status,"onUpdate:modelValue":o[2]||(o[2]=e=>s.status=e),placeholder:"请选择课题状态",clearable:"",class:"!w-[180px]"},{default:n(()=>[(h(!0),S(W,null,z(a(B),(e,d)=>(h(),$(D,{key:d,label:e,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,null,{default:n(()=>[l(L,{icon:a(q)(a(se)),onClick:o[3]||(o[3]=e=>E(y.value))},{default:n(()=>[R(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),l(a(ne),{title:"课题列表",onRefresh:a(M),class:"overflow-hidden"},{buttons:n(()=>[l(L,{type:"primary",icon:a(q)(a(ie)),onClick:o[4]||(o[4]=e=>T.value=!0)},{default:n(()=>[R(" 新增课题 ")]),_:1},8,["icon"])]),default:n(({size:e,checkList:d})=>[l(K,{border:"","align-whole":"center",showOverflowTooltip:"",loading:a(w),"loading-config":a(i),size:e,height:e==="small"?360:500,data:a(A).slice((a(m).currentPage-1)*a(m).pageSize,a(m).currentPage*a(m).pageSize),columns:a(v),checkList:d,pagination:a(m),paginationSmall:e==="small","header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"},onPageSizeChange:a(t),onPageCurrentChange:a(k)},{operation:n(({row:I})=>[l(L,{class:"reset-margin",link:"",type:"danger",size:e,icon:a(q)(a(re)),disabled:!!I.student,onClick:fe=>a(V)(I)},{default:n(()=>[R(" 删除 ")]),_:2},1032,["size","icon","disabled","onClick"])]),_:2},1032,["loading","loading-config","size","height","data","columns","checkList","pagination","paginationSmall","header-cell-style","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["onRefresh"]),l(Q,{modelValue:T.value,"onUpdate:modelValue":o[9]||(o[9]=e=>T.value=e),title:"新增课题",width:"500px","destroy-on-close":!0,"before-close":Y},{footer:n(()=>[l(L,{type:"primary",onClick:o[8]||(o[8]=e=>J(P.value))},{default:n(()=>[R(" 添加 ")]),_:1})]),default:n(()=>[l(H,{ref_key:"ruleFormRef",ref:P,model:u,rules:G,"label-width":"100px","status-icon":""},{default:n(()=>[l(_,{label:"课题名称",prop:"title"},{default:n(()=>[l(g,{modelValue:u.title,"onUpdate:modelValue":o[5]||(o[5]=e=>u.title=e),placeholder:"请输入课题名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"课题类型",prop:"type"},{default:n(()=>[l(U,{modelValue:u.type,"onUpdate:modelValue":o[6]||(o[6]=e=>u.type=e),placeholder:"请选择课题类型",class:"w-full"},{default:n(()=>[(h(!0),S(W,null,z(a(C),(e,d)=>(h(),$(D,{key:d,label:e,value:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"课题简介",prop:"introduce"},{default:n(()=>[l(g,{type:"textarea",modelValue:u.introduce,"onUpdate:modelValue":o[7]||(o[7]=e=>u.introduce=e),placeholder:"请输入课题简介"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const Ce=oe(me,[["__scopeId","data-v-4bb9c624"]]);export{Ce as default};
