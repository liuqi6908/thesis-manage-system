import{r as y,a as L,o as J,g as o,b as f,q,E,D as U,d as H,c as G,w as K,e as D,f as W,i as r,u as t,j as M,F as Q,l as X,x as Z,_ as ee}from"./index-6808ba74.js";import{m as _}from"./message-27522a78.js";import{a as te,t as le}from"./topic-d41e4ebe.js";import{P as F}from"./index-eb0c4c8c.js";import{u as $}from"./hooks-62a2627c.js";import{D as ae}from"./delete-6d738bc7.js";import{E as oe}from"./edit-pen-af58ba35.js";import{R as ne}from"./refresh-74425c09.js";import"./epTheme-ce7d143e.js";function re(){const g=y(),i=y(!0),c=y(),b=L(["可选","已满","待确认","驳回","接收"]),n=y(!0),h=L({text:"正在加载第1页...",viewBox:"-10, -10, 50, 50",spinner:`
        <path class="path" d="
          M 30 15
          L 28 17
          M 25.61 25.61
          A 15 15, 0, 0, 1, 15 30
          A 15 15, 0, 1, 1, 27.99 7.5
          L 15 15
        " style="stroke-width: 4px; fill: rgba(0, 0, 0, 0)"/>
      `}),x=L({total:0,pageSize:10,currentPage:1,background:!0}),w=[{type:"selection",width:50,align:"left",hide:({checkList:e})=>!e.includes("勾选列")},{label:"序号",type:"index",width:70,hide:({checkList:e})=>!e.includes("序号列")},{label:"课题名称",prop:"title",minWidth:260},{label:"指导教师",prop:"teacher",minWidth:120},{label:"可接收总人数",prop:"total",minWidth:120},{label:"状态",minWidth:100,cellRenderer:e=>o(f("el-tag"),{key:e.row.id,type:["success","info","warning","danger","primary"][e.row.status],class:"mx-1",effect:"light"},{default:()=>[b[e.row.status]]})},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:e})=>q(e).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:100,slot:"operation"}];function V(e){if(g.value.length>=3)return _("选题失败，已达选题数量上限",{type:"error",grouping:!0});E.confirm(`确认要 <strong>选择</strong> <strong style='color:var(--el-color-primary)'>
      ${e.teacher}</strong> 的 <strong style='color:var(--el-color-primary)'>
      ${e.title}</strong> 课题吗?`,"选题提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value=!0,n.value=!0,setTimeout(()=>{const d=c.value.map(l=>l.id).indexOf(e.id);d>-1&&(c.value[d].status=2),g.value.push(JSON.parse(JSON.stringify(c.value[d]))),_("选题成功",{type:"success"}),i.value=!1,n.value=!1},500)}).catch(()=>{})}function u(e){E.confirm(`确认要 <strong>退选</strong> <strong style='color:var(--el-color-primary)'>
      ${e.teacher}</strong> 的 <strong style='color:var(--el-color-primary)'>
      ${e.title}</strong> 课题吗?`,"退选提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{i.value=!0,n.value=!0,setTimeout(()=>{const d=g.value.map(v=>v.id).indexOf(e.id);d>-1&&g.value.splice(d,1);const l=c.value.map(v=>v.id).indexOf(e.id);l>-1&&(c.value[l].status=0),_("退选成功",{type:"success"}),i.value=!1,n.value=!1},500)}).catch(()=>{})}function B(){h.text="正在加载...",n.value=!0,U(500).then(()=>{n.value=!1})}function P(e){h.text=`正在加载第${e}页...`,n.value=!0,U(500).then(()=>{n.value=!1})}function C(){n.value=!0,te().then(e=>{e.success?(c.value=e.data,x.total=e.data.length):_(e.message,{type:"error"})}).finally(()=>{setTimeout(()=>{n.value=!1},500)})}function S(){i.value=!0,le().then(e=>{e.success?g.value=e.data:_(e.message,{type:"error"})}).finally(()=>{setTimeout(()=>{i.value=!1},500)})}return J(()=>{C(),S()}),{topicInfo:g,topicLoading:i,dataList:c,loading:n,loadingConfig:h,columns:w,statusList:b,pagination:x,onSearchDataList:C,onSearchTopicInfo:S,handleSelect:V,handleDelete:u,handleSizeChange:B,handleCurrentChange:P}}const se={class:"main"},ie=H({name:"ThesisTopicSelection"}),ce=H({...ie,setup(g){const i=y(),{topicInfo:c,topicLoading:b,dataList:n,loading:h,loadingConfig:x,columns:w,statusList:V,pagination:u,onSearchDataList:B,onSearchTopicInfo:P,handleSelect:C,handleDelete:S,handleSizeChange:e,handleCurrentChange:d}=re(),l=L({title:"",teacher:"",status:null}),v=s=>{s&&s.resetFields()},z=G(()=>n.value?n.value.filter(s=>s.title?s.title.toString().toLowerCase().includes(l.title):!1).filter(s=>s.teacher?s.teacher.toString().toLowerCase().includes(l.teacher):!1).filter(s=>[0,1,2,3,4].includes(l.status)?s.status===l.status:!0):[]);return K(()=>{u.total=z.value.length}),(s,p)=>{const R=f("el-button"),O=f("pure-table"),I=f("el-input"),T=f("el-form-item"),N=f("el-option"),Y=f("el-select"),j=f("el-form");return D(),W("div",se,[o(t(F),{title:"毕设已选课题",onRefresh:t(P),class:"overflow-hidden"},{default:r(({size:a,checkList:m})=>[o(O,{border:"","align-whole":"center",showOverflowTooltip:"",loading:t(b),size:a,data:t(c),columns:t(w),checkList:m,"header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"}},{operation:r(({row:k})=>[o(R,{class:"reset-margin",link:"",type:"danger",size:a,icon:t($)(t(ae)),onClick:A=>t(S)(k)},{default:r(()=>[M(" 删除 ")]),_:2},1032,["size","icon","onClick"])]),_:2},1032,["loading","size","data","columns","checkList","header-cell-style"])]),_:1},8,["onRefresh"]),o(j,{ref_key:"formRef",ref:i,inline:!0,model:l,class:"bg-bg_color w-[99/100] pl-8 pt-4 mt-6"},{default:r(()=>[o(T,{label:"课题名称：",prop:"title"},{default:r(()=>[o(I,{modelValue:l.title,"onUpdate:modelValue":p[0]||(p[0]=a=>l.title=a),placeholder:"请输入课题名称",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),o(T,{label:"指导教师：",prop:"teacher"},{default:r(()=>[o(I,{modelValue:l.teacher,"onUpdate:modelValue":p[1]||(p[1]=a=>l.teacher=a),placeholder:"请输入指导教师姓名",clearable:"",class:"!w-[200px]"},null,8,["modelValue"])]),_:1}),o(T,{label:"状态：",prop:"status"},{default:r(()=>[o(Y,{modelValue:l.status,"onUpdate:modelValue":p[2]||(p[2]=a=>l.status=a),placeholder:"请选择状态",clearable:"",class:"!w-[180px]"},{default:r(()=>[(D(!0),W(Q,null,X(t(V),(a,m)=>(D(),Z(N,{key:m,label:a,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(T,null,{default:r(()=>[o(R,{icon:t($)(t(ne)),onClick:p[3]||(p[3]=a=>v(i.value))},{default:r(()=>[M(" 重置 ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),o(t(F),{title:"毕设课题列表",onRefresh:t(B),class:"overflow-hidden"},{default:r(({size:a,checkList:m})=>[o(O,{border:"","align-whole":"center",showOverflowTooltip:"",loading:t(h),"loading-config":t(x),size:a,height:a==="small"?360:500,data:t(z).slice((t(u).currentPage-1)*t(u).pageSize,t(u).currentPage*t(u).pageSize),columns:t(w),checkList:m,pagination:t(u),paginationSmall:a==="small","header-cell-style":{background:"var(--el-table-row-hover-bg-color)",color:"var(--el-text-color-primary)"},onPageSizeChange:t(e),onPageCurrentChange:t(d)},{operation:r(({row:k})=>[o(R,{class:"reset-margin",link:"",type:"primary",size:a,icon:t($)(t(oe)),disabled:k.status!==0,onClick:A=>t(C)(k)},{default:r(()=>[M(" 选题 ")]),_:2},1032,["size","icon","disabled","onClick"])]),_:2},1032,["loading","loading-config","size","height","data","columns","checkList","pagination","paginationSmall","header-cell-style","onPageSizeChange","onPageCurrentChange"])]),_:1},8,["onRefresh"])])}}});const ye=ee(ce,[["__scopeId","data-v-65021089"]]);export{ye as default};
